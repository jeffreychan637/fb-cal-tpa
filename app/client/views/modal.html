<div ng-controller="ModalCtrl">
  <div class="app" ng-show="eventInfo || true">
    <div class="page-header" id="header">
      <h1 class="name title"><a ng-href="https://www.facebook.com/events/{{id}}" target="blank">{{name}}</a></h1>
      <h6 class="name host" ng-if="settings.hostedBy">
        <em>Hosted by <strong><a ng-href="https://www.facebook.com/{{ownerId}}" target="blank">{{owner}}</a></strong></em>
      </h6>
    </div>
    <div class="container-fluid">
      <div class="row">
        <div class="col-sm-6 left-col">
          <div class="col-sm-12 left-col">
            <div class="block" id="rsvp">
              <span class="icon-mail icon"></span>
              <div class="dropdown rsvp">
                <button class="btn btn-default dropdown-toggle" type="button" id="rsvp" data-toggle="dropdown">
                  {{rsvpStatus}}
                  <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                  <li role="presentation"><a role="menuitem" tabindex="-1" href="#" ng-click="interactWithFb('attending', undefined)">
                    Going
                  </a></li>
                  <li role="presentation"><a role="menuitem" tabindex="-1" href="#" ng-click="interactWithFb('maybe', undefined)">
                    Maybe
                  </a></li>
                  <li role="presentation"><a role="menuitem" tabindex="-1" href="#" ng-click="interactWithFb('declined', undefined)">
                    Decline
                  </a></li>
                </ul>
              </div>
              <div class="dropdown rsvp">
                <button class="btn btn-default dropdown-toggle" type="button" id="share" data-toggle="dropdown">
                  Share
                  <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu2">
                  <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Via Facebook</a></li>
                  <li role="presentation"><a role="menuitem" tabindex="-1" href="#">Get Event Link</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="col-sm-12 left-col">
            <div class="block" id="guests">
              <h4 class="main-text">
                <span class="icon-friend icon friend" data-icon="e"></span>
                <span ng-hide="stats || guestFailed">
                  Getting Guest Stats...
                </span>
                <span ng-show="guestFailed">
                  No Guest Stats Available
                </span>
                <span class="event-stat going" ng-show="stats.attending_count || stats.attending_count >= 0">
                  {{stats.attending_count}}
                </span>
                <span class="event-stat maybe" ng-show="stats.unsure_count || stats.unsure_count >= 0">
                  {{stats.unsure_count}}
                </span>
                <span class="event-stat invited" ng-show="stats.not_replied_count || stats.not_replied_count >= 0">
                  {{stats.not_replied_count}}
                </span>
              </h4>
              <h6 class="sub-text" ng-show="stats">
                <span class="stat-label" ng-show="stats.attending_count || stats.attending_count >= 0">
                  Going
                </span>
                <span class="stat-label" ng-show="stats.unsure_count || stats.unsure_count >= 0">
                  Maybe
                </span>
                <span class="stat-label" ng-show="stats.not_replied_count || stats.not_replied_count >= 0">
                  Invited
                </span>
              </h6>
            </div>
          </div>
        </div>
        <div class="col-sm-6 right-col">
          <div class="col-sm-12 right-col">
            <div class="block" id="time">
              <h4 class="main-text">
                <span class="icon-clock icon" data-icon="c"></span>
                {{shortTime}}
              </h4>
              <h6 class="sub-text" ng-if="longTime">
                {{longTime}}
              </h6>
            </div>
          </div>
          <div class="col-sm-12 right-col">
            <div class="block" id="location">
              <h4 class="main-text">
                <span class="icon-location icon" data-icon="b"></span>
                <a href="https://maps.google.com/?q={{location}}" target="blank">
                  {{location}}
                </a>
              </h4>
              <h6 class="sub-text" ng-if="venue">
                <a href="https://maps.google.com/?q={{location}}" target="blank">{{venue}}</a>
              </h6>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-sm-12 middle-col">
          <div class="block">
            <span ng-bind-html="description" ng-if="showDescription">
            </span>
          </div>
        </div>
      </div>
      <div class="row" ng-show="settings.commenting">
        <div class="col-sm-12 middle-col">
          <div class="block">
            <form class="input-group" ng-model="postForm" id="postForm" name="postForm">
              <textarea name="post" id="post" placeholder="Post to event's Facebook page..." class="form-control" ng-model="post"></textarea>
              <span class="input-group-btn">
                <button type="submit" class="btn btn-default post-btn" ng-click="interactWithFb('post', undefined, post); post = '';">Post!</button>
              </span>
            </form>
          </div>
        </div>
      </div>
      <div ng-repeat="status in feed">
        <div class="row">
          <div class="col-sm-10 col-sm-offset-1">
            <div class="block">
              <blockquote><strong>{{status.name}}</strong> posted <em><span ng-bind-html="status.message"></span></em>
                <br>
                {{status.time}}
                <a class="push-left" ng-show="status.like && !status.comment && settings.commenting" ng-click="interactWithFb('like', $index, undefined)">Like</a>
                <span class="push-left" ng-show="status.numberLikes">
                  {{status.numberLikes}} Likes
                </span>
                <span class="push-left" ng-show="status.numberShares">
                  {{status.numberShares}} Shares
                </span>
                <img ng-if="status.picture" ng-src="{{status.picture}}" class="center-block img-thumbnail img-responsive">
                <a ng-href="{{status.link}}" target="blank" ng-if="status.link">{{status.link}}</a>
                <br ng-if="status.linkName">
                <span ng-if="status.linkName">{{status.linkName}}</span>
                <br ng-if="status.caption">
                <span ng-if="status.caption">{{status.caption}}</span>
                <br ng-if="status.description">
                <span ng-if="status.description">{{status.description}}</span>
              </blockquote>
            </div>
            <div class="block add-on" ng-show="status.comment && settings.commenting">
              <form class="input-group" ng-if="status.like && status.comment">
                <span class="input-group-btn">
                  <button class="btn btn-default comment-btn" type="button" ng-click="interactWithFb('like', $index, undefined)">Like</button>
                </span>
                <input type="text" class="form-control" placeholder="Comment..." ng-model="visitorComment">
                <span class="input-group-btn">
                  <button class="btn btn-default comment-btn" type="submit" ng-click="interactWithFb('comment', $index, visitorComment); visitorComment = '';">Post!</button>
                </span>
              </form>
              <form class="input-group" ng-if="!status.like && status.comment">
                <input type="text" class="form-control" placeholder="Comment..." ng-model="visitorComment">
                <span class="input-group-btn">
                  <button class="btn btn-default comment-btn" type="submit" ng-click="interactWithFb('comment', $index, vistorComment); visitorComment = '';">Post!</button>
                </span>
              </form>
            </div>
            <div class="block add-on" ng-if="status.comments">
              <div ng-repeat="comment in status.comments">
                <blockquote><strong>{{comment.name}}</strong> replied <em><span ng-bind-html="comment.message"></span></em>
                  <br>
                  {{comment.time}}
                  <a class="push-left" ng-if="settings.commenting" ng-click="interactWithFb('likeComment', comment.id, undefined)">Like</a>
                  <span class="push-left" ng-show="comment.numberLikes">{{comment.numberLikes}} Likes</span>
                </blockquote>
              </div>
              <a class="push-left" ng-if="status.repliesMessage" ng-click="showMoreReplies($index)">{{status.repliesMessage}}</a>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
         <div class="col-sm-4 col-sm-offset-4">
          <div class="block" ng-if="moreFeedMessage">
            <p class="text-center load-posts" ng-click="showMoreFeed()">{{moreFeedMessage}}</p>
            </div>
        </div>
      </div>
    </div>
    <div class="modal fade" id="message" tabindex="-1" role="dialog" aria-labelledby="messageTitle" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            <h4 class="modal-title" id="messageTitle">{{messageTitle}}</h4>
          </div>
          <div class="modal-body">
            {{messageBody}}
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default modal-btn" data-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
